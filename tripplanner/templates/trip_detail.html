<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{{ trip.trip_name }}</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background: linear-gradient(to bottom, #e0f7fa, #ffffff);
      font-family: 'Segoe UI', sans-serif;
    }

    .bg-cover {
      background-size: cover;
      background-position: center;
      min-height: 300px;
      border-radius: 1rem;
      color: white;
      display: flex;
      align-items: flex-end;
      padding: 2rem;
      background-blend-mode: overlay;
      background-color: rgba(0, 0, 0, 0.4);
    }

    .scrolling-wrapper {
      overflow-x: auto;
      white-space: nowrap;
    }

    .scrolling-wrapper .card {
      display: inline-block;
      min-width: 260px;
      margin-right: 1rem;
    }

    .day-card {
      border-left: 4px solid #00bcd4;
      padding-left: 1rem;
      background: #f8f9fa;
      margin-bottom: 1.5rem;
      border-radius: 0.5rem;
    }

    .hotel-img {
      height: 180px;
      width: 100%;
      object-fit: cover;
      border-top-left-radius: 0.375rem;
      border-top-right-radius: 0.375rem;
    }
  </style>
</head>

<body>
  <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
    <div class="container">
      <a class="navbar-brand fw-bold" href="/">TripPlanner AI</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link active fw-semibold" href="/">Home</a></li>
          <li class="nav-item"><a class="nav-link" href="/create-trip">Create New Trip</a></li>
          <li class="nav-item"><a class="nav-link" href="/history">History</a></li>
          <li class="nav-item"><a class="nav-link" href="/favorites">Favorites</a></li>
        </ul>
      </div>
    </div>
  </nav>
  <div class="container py-4">
    <div class="text-end mb-3 d-flex gap-2 justify-content-end flex-wrap">
      {% if is_favorite %}
      <form action="{{ url_for('unfavorite_trip', trip_id=trip._id) }}" method="POST" class="d-inline">
        <button type="submit" class="btn btn-outline-danger btn-sm">ğŸ’” Bá» yÃªu thÃ­ch</button>
      </form>
      {% else %}
      <form action="{{ url_for('favorite_trip', trip_id=trip._id) }}" method="POST" class="d-inline">
        <button type="submit" class="btn btn-outline-primary btn-sm">â¤ï¸ ThÃªm vÃ o yÃªu thÃ­ch</button>
      </form>
      {% endif %}

      <form class="d-inline">
        <button type="button" class="btn btn-outline-secondary btn-sm" onclick="copyTripLink()">ğŸ”— Chia sáº» chuyáº¿n
          Ä‘i</button>
      </form>

      <form class="d-inline">
        <button type="button" class="btn btn-outline-success btn-sm" onclick="downloadPDF()">ğŸ§¾ LÆ°u PDF</button>
      </form>
    </div>

    <!-- 1. Äiá»ƒm Ä‘áº¿n -->
    <div class="mb-5">
      <div class="bg-cover" style="background-image: url('{{ trip.destination_image_url }}');">
        <div>
          <h2 class="fw-bold">{{ trip.main_destination }}</h2>
          <p>{{ trip.destination_description }}</p>
        </div>
      </div>
    </div>

    <!-- 2. Khuyáº¿n nghá»‹ chá»— á»Ÿ -->
    <div class="mb-5">
      <h4 class="mb-3">ğŸ¨ Gá»£i Ã½ chá»— á»Ÿ</h4>
      <div class="scrolling-wrapper">
        {% for hotel in trip.accommodations %}
        <div class="card shadow-sm">
          <img src="{{ hotel.image }}" class="hotel-img" alt="hotel">
          <div class="card-body">
            <h5 class="card-title">{{ hotel.name }}</h5>
            <p class="card-text text-muted">{{ hotel.location }}</p>
            <a href="{{ hotel.link }}" target="_blank" class="btn btn-sm btn-outline-primary">Xem thÃªm</a>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>

    <!-- 3. Lá»‹ch trÃ¬nh -->
    <div class="mb-5">
      <h4 class="mb-3">ğŸ“… Lá»‹ch trÃ¬nh</h4>
      {% for day in trip.itinerary %}
      <div class="day-card">
        <h5 class="mb-3">ğŸ—“ï¸ Day {{ loop.index }}</h5>
        {% for stop in day.stops %}
        <div class="mb-3">
          <h6>{{ stop.name }}</h6>
          <p class="mb-1 text-muted">{{ stop.description }}</p>
          <small>
            <a href="https://www.google.com/maps/search/?api=1&query={{ stop.map_query | urlencode }}" target="_blank">
              ğŸ“ Xem báº£n Ä‘á»“
            </a>
            â€“ â± {{ stop.estimated_time }}
          </small>
        </div>
        {% endfor %}
      </div>
      {% endfor %}
    </div>

    <!-- 4. Chi phÃ­ -->
    <div class="mb-5">
      <h4 class="mb-3">ğŸ’° Chi phÃ­ Æ°á»›c tÃ­nh</h4>
      <div class="row g-4">
        <div class="col-md-3">
          <div class="card p-3 shadow-sm h-100">
            <h6>ğŸ›ï¸ Nghá»‰ ngÆ¡i</h6>
            <p>{{ trip.cost.accommodation }} VND</p>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card p-3 shadow-sm h-100">
            <h6>ğŸœ Ä‚n uá»‘ng</h6>
            <p>{{ trip.cost.food }} VND</p>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card p-3 shadow-sm h-100">
            <h6>ğŸšŒ Di chuyá»ƒn</h6>
            <p>{{ trip.cost.transport }} VND</p>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card p-3 shadow-sm h-100">
            <h6>ğŸŸï¸ Hoáº¡t Ä‘á»™ng</h6>
            <p>{{ trip.cost.activities }} VND</p>
          </div>
        </div>
      </div>
    </div>

  </div>

  <script>
    function copyTripLink() {
      const dummy = document.createElement("input");
      const url = window.location.href;
      document.body.appendChild(dummy);
      dummy.value = url;
      dummy.select();
      document.execCommand("copy");
      document.body.removeChild(dummy);

      alert("ğŸ“‹ LiÃªn káº¿t Ä‘Ã£ Ä‘Æ°á»£c sao chÃ©p!");
    }
    function downloadPDF() {
      window.print();
    }
  </script>
</body>

</html>